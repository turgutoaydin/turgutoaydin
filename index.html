<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Alien Tower Defence</title>

    <style>
        *{
            box-sizing: border-box;
            font-family: Arial, sans-serif;
        }

        body{
            margin:0;
            background:#020617;
            color:white;
            display:flex;
            flex-direction:column;
            align-items:center;
            justify-content:center;
        }

        canvas{
            background: radial-gradient(circle at center, #0b1035, #020617 65%);
            border:2px solid #0ea5e9;
            border-radius:12px;
            width: 95vw;
            height: 70vh;
            max-width:600px;
        }

        .hud{
            width:95vw;
            max-width:600px;
            display:flex;
            justify-content:space-between;
            margin:10px 0;
        }

        .panel{
            width:95vw;
            max-width:600px;
            display:flex;
            justify-content:space-around;
            margin-top:10px;
        }

        button{
            padding:10px 15px;
            border-radius:8px;
            border:none;
            background:#0ea5e9;
            font-weight:bold;
            color:white;
        }

        button:active{
            transform:scale(.96);
        }
    </style>
</head>

<body>

<div class="hud">
    <div>Can: <span id="hp">100</span></div>
    <div>Altın: <span id="gold">0</span></div>
    <div>Dalga: <span id="wave">1</span></div>
</div>

<canvas id="gameCanvas"></canvas>

<div class="panel">
    <button id="upgradeDamage">Hasar +</button>
    <button id="upgradeSpeed">Hız +</button>
</div>

<script>
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");

// mobil tuvale uygun ölçü
canvas.width = 350;
canvas.height = 550;

// kule
let tower = {
    x: canvas.width / 2,
    y: canvas.height - 80,
    radius: 25,
    hp: 100,
    damage: 10,
    fireRate: 600
};

let bullets = [];
let enemies = [];
let gold = 0;
let wave = 1;

document.getElementById("hp").innerText = tower.hp;
document.getElementById("gold").innerText = gold;
document.getElementById("wave").innerText = wave;

// dalga üret
function spawnWave() {
    for(let i=0;i<wave+2;i++){
        enemies.push({
            x: Math.random()*canvas.width,
            y: -20,
            radius: 18,
            speed: 0.6 + wave*0.1,
            hp: 20 + wave*5
        });
    }
}

spawnWave();

// otomatik ateş
setInterval(()=> {
    if(enemies.length === 0) return;

    let target = enemies[0];

    bullets.push({
        x:tower.x,
        y:tower.y,
        target:target,
        speed:4
    });

}, tower.fireRate);

// oyun döngüsü
function update(){
    ctx.clearRect(0,0,canvas.width,canvas.height);

    // kule
    ctx.fillStyle="cyan";
    ctx.beginPath();
    ctx.arc(tower.x,tower.y,tower.radius,0,Math.PI*2);
    ctx.fill();

    // düşmanlar
    enemies.forEach((e,index)=>{
        e.y += e.speed;

        // kuleye çarparsa
        if(e.y >= tower.y-30){
            tower.hp -= 5;
            enemies.splice(index,1);
            document.getElementById("hp").innerText = tower.hp;
        }

        ctx.fillStyle="lime";
        ctx.beginPath();
        ctx.arc(e.x,e.y,e.radius,0,Math.PI*2);
        ctx.fill();
    });

    // mermi
    bullets.forEach((b,bIndex)=>{
        if(!b.target) return;

        let dx = b.target.x - b.x;
        let dy = b.target.y - b.y;
        let dist = Math.hypot(dx,dy);

        b.x += dx/dist*b.speed;
        b.y += dy/dist*b.speed;

        ctx.fillStyle="yellow";
        ctx.beginPath();
        ctx.arc(b.x,b.y,4,0,Math.PI*2);
        ctx.fill();

        // isabet algılama
        if(dist<10){
            b.target.hp -= tower.damage;

            if(b.target.hp<=0){
                gold += 5;
                enemies.splice(enemies.indexOf(b.target),1);
                document.getElementById("gold").innerText = gold;
            }

            bullets.splice(bIndex,1);
        }
    });

    // yeni dalga
    if(enemies.length===0){
        wave++;
        document.getElementById("wave").innerText = wave;
        spawnWave();
    }

    requestAnimationFrame(update);
}

update();

// geliştirme butonları
document.getElementById("upgradeDamage").onclick = ()=>{
    if(gold>=20){
        gold-=20;
        tower.damage+=5;
        document.getElementById("gold").innerText = gold;
    }
};

document.getElementById("upgradeSpeed").onclick = ()=>{
    if(gold>=20){
        gold-=20;
        tower.fireRate = Math.max(150, tower.fireRate-60);
        document.getElementById("gold").innerText = gold;
    }
};
</script>

</body>
</html>