<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
  <title>Köy Merkezi - 3D Demo</title>
  <style>
    body { margin:0; overflow:hidden; background:#000; font-family:Arial, sans-serif; }
    #ui {
      position: absolute;
      top: 12px; left: 12px; color: white;
      background: rgba(0,0,0,0.4);
      padding: 10px 14px;
      border-radius: 8px;
      pointer-events: none;
      font-size: 13px;
      z-index: 10;
    }
    #info {
      position: absolute;
      bottom: 16px; left: 50%;
      transform: translateX(-50%);
      color: #eee;
      font-size: 14px;
      text-shadow: 0 1px 3px #000;
      pointer-events: none;
      z-index: 10;
    }
  </style>
</head>
<body>

<div id="ui">Köy Merkezi 3D Demo<br>Parmakla döndür • Çift parmakla zoom</div>
<div id="info">My Village – Köyüm büyüyor...</div>

<script src="https://cdn.jsdelivr.net/npm/three@0.168.0/build/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.168.0/examples/js/controls/OrbitControls.min.js"></script>

<script>
// ======================== SAHNE AYARLARI ========================
const scene = new THREE.Scene();
scene.background = new THREE.Color(0x88aaff);           // Gökyüzü mavisi
scene.fog = new THREE.FogExp2(0x88aaff, 0.0009);        // Hafif sis efekti

const camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 0.1, 2000);
camera.position.set(18, 14, 22);

const renderer = new THREE.WebGLRenderer({ antialias: true });
renderer.setSize(window.innerWidth, window.innerHeight);
renderer.setPixelRatio(window.devicePixelRatio);
renderer.shadowMap.enabled = true;
renderer.shadowMap.type = THREE.PCFSoftShadowMap;
document.body.appendChild(renderer.domElement);

// Mobil dostu kontroller
const controls = new THREE.OrbitControls(camera, renderer.domElement);
controls.enableDamping = true;
controls.dampingFactor = 0.07;
controls.rotateSpeed = 0.5;
controls.zoomSpeed = 0.9;
controls.minDistance = 8;
controls.maxDistance = 60;
controls.maxPolarAngle = Math.PI * 0.48;   // Çok aşağı bakmayı engeller
controls.target.set(0, 1, 0);

// Işıklar
const ambient = new THREE.AmbientLight(0xffffff, 0.55);
scene.add(ambient);

const sun = new THREE.DirectionalLight(0xfff8e8, 1.1);
sun.position.set(30, 60, 40);
sun.castShadow = true;
sun.shadow.mapSize.width = 2048;
sun.shadow.mapSize.height = 2048;
sun.shadow.camera.near = 0.5;
sun.shadow.camera.far = 150;
sun.shadow.camera.left = -40;
sun.shadow.camera.right = 40;
sun.shadow.camera.top = 40;
sun.shadow.camera.bottom = -40;
scene.add(sun);

// ======================== ARAZİ (Terrain) ========================
const terrainSize = 80;
const segments = 80;

const geometry = new THREE.PlaneGeometry(terrainSize, terrainSize, segments, segments);
geometry.rotateX(-Math.PI / 2);

const vertices = geometry.attributes.position.array;

for (let i = 2; i < vertices.length; i += 3) {
  const x = vertices[i-2];
  const z = vertices[i];
  // Basit sinüs + gürültü ile hafif engebeli arazi
  vertices[i] = 
    Math.sin(x * 0.15) * 1.8 + 
    Math.sin(z * 0.22) * 1.4 +
    Math.sin(x * 0.4 + z * 0.3) * 0.9;
}

geometry.computeVertexNormals();

const terrainMaterial = new THREE.MeshStandardMaterial({
  color: 0x5b8c3f,        // Çimen yeşili
  roughness: 0.9,
  metalness: 0.05
});

const terrain = new THREE.Mesh(geometry, terrainMaterial);
terrain.receiveShadow = true;
scene.add(terrain);

// ======================== KÖY NESNELERİ ========================

// Yardımcı fonksiyon: low-poly ev
function createHouse(x, z, scale = 1, color = 0xe06666) {
  const group = new THREE.Group();

  // Taban
  const base = new THREE.Mesh(
    new THREE.BoxGeometry(5*scale, 0.4*scale, 6*scale),
    new THREE.MeshStandardMaterial({color: 0xaaaaaa})
  );
  base.position.y = 0.2*scale;
  base.castShadow = true;
  group.add(base);

  // Duvarlar
  const walls = new THREE.Mesh(
    new THREE.BoxGeometry(4.6*scale, 3.2*scale, 5.6*scale),
    new THREE.MeshStandardMaterial({color})
  );
  walls.position.y = 1.8*scale;
  walls.castShadow = true;
  group.add(walls);

  // Çatı
  const roofGeo = new THREE.ConeGeometry(4.2*scale, 3*scale, 4);
  roofGeo.rotateY(Math.PI/4);
  const roof = new THREE.Mesh(
    roofGeo,
    new THREE.MeshStandardMaterial({color: 0x8b0000})
  );
  roof.position.y = 3.8*scale;
  roof.castShadow = true;
  group.add(roof);

  group.position.set(x, 0, z);
  return group;
}

// Yardımcı fonksiyon: Ağaç (basit low-poly)
function createTree(x, z) {
  const group = new THREE.Group();

  const trunk = new THREE.Mesh(
    new THREE.CylinderGeometry(0.6, 0.9, 4, 6),
    new THREE.MeshStandardMaterial({color: 0x8B4513})
  );
  trunk.position.y = 2;
  trunk.castShadow = true;
  group.add(trunk);

  const leaves = new THREE.Mesh(
    new THREE.ConeGeometry(3.2, 5.5, 6),
    new THREE.MeshStandardMaterial({color: 0x2e7d32})
  );
  leaves.position.y = 5.2;
  leaves.castShadow = true;
  group.add(leaves);

  const leaves2 = leaves.clone();
  leaves2.scale.set(0.8, 0.8, 0.8);
  leaves2.position.y = 6.8;
  group.add(leaves2);

  group.position.set(x, 0, z);
  return group;
}

// Köyü yerleştir
scene.add(createHouse(-8, -6, 1.1, 0xe57373));   // Kırmızı ev
scene.add(createHouse(5, -9, 0.95, 0x64b5f6));   // Mavi ev
scene.add(createHouse(12, 4, 1.2, 0xffb74d));    // Turuncu ev

scene.add(createTree(-14, 8));
scene.add(createTree(15, -12));
scene.add(createTree(-3, 14));
scene.add(createTree(9, 11));

// Küçük gölet / su
const waterGeo = new THREE.CircleGeometry(6, 32);
const waterMat = new THREE.MeshStandardMaterial({
  color: 0x448aff,
  roughness: 0,
  metalness: 0.3,
  transparent: true,
  opacity: 0.75
});
const water = new THREE.Mesh(waterGeo, waterMat);
water.rotation.x = -Math.PI/2;
water.position.set(-2, 0.1, 10);
scene.add(water);

// ======================== ANİMASYON DÖNGÜSÜ ========================
function animate() {
  requestAnimationFrame(animate);
  controls.update();
  renderer.render(scene, camera);
}
animate();

// ======================== RESPONSIVE ========================
window.addEventListener('resize', () => {
  camera.aspect = window.innerWidth / window.innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(window.innerWidth, window.innerHeight);
});
</script>
</body>
</html>