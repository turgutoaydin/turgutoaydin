<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
  <title>SpinDEX ‚Äì Crypto Slot</title>
  <script src="https://cdn.jsdelivr.net/npm/phaser@3.70.0/dist/phaser.min.js"></script>
  <script src="https://unpkg.com/@tonconnect/ui@1.0.0/dist/tonconnect-ui.min.js"></script>
  <style>
    body { margin:0; padding:0; background:#000; font-family: 'Arial', sans-serif; overflow:hidden; }
    #game-container { width:100vw; height:100vh; }
    .ui { position:absolute; top:0; left:0; width:100%; height:100%; pointer-events:none; color:#fff; z-index:10; }
    .balance { top:15px; left:20px; font-size:20px; font-weight:bold; background:rgba(0,0,0,0.6); padding:10px 20px; border-radius:12px; pointer-events:all; cursor:pointer; }
    .bet-controls { bottom:20px; left:50%; transform:translateX(-50%); background:rgba(0,0,0,0.7); padding:15px; border-radius:20px; text-align:center; pointer-events:all; }
    .spin-btn { background:#ffeb3b; color:#000; font-weight:bold; font-size:28px; padding:15px 60px; border-radius:50px; margin-top:10px; cursor:pointer; box-shadow:0 8px #c8a800; }
    .spin-btn:active { transform:translateY(4px); box-shadow:0 4px #c8a800; }
    .win-popup { position:absolute; top:50%; left:50%; transform:translate(-50%,-50%) scale(0); background:rgba(0,0,0,0.9); padding:40px; border:5px solid #ffd700; border-radius:20px; text-align:center; font-size:50px; color:#ffd700; transition:0.5s; }
  </style>
</head>
<body>
  <div id="game-container"></div>

  <div class="ui">
    <div class="balance" id="balance">Bakiye: 1000.00 USDT (Demo)</div>
    <div class="bet-controls">
      <div style="margin-bottom:10px;">
        <button onclick="changeBet(-0.2)" style="padding:10px 20px;font-size:20px;">-</button>
        <span id="betAmount" style="margin:0 30px;font-size:28px;font-weight:bold;">1.00</span> USDT
        <button onclick="changeBet(0.2)" style="padding:10px 20px;font-size:20px;">+</button>
      </div>
      <div class="spin-btn" id="spinBtn" onclick="spin()">SPIN</div>
      <div style="margin-top:10px;color:#888;">Demo Mod ‚Äì Ger√ßek USDT ile oynayƒ±n ‚Üí</div>
      <button onclick="connectWallet()" style="background:#00d4ff;color:#000;padding:10px 20px;border:none;border-radius:10px;margin-top:5px;font-weight:bold;">
        Connect TON Wallet
      </button>
    </div>
    <div class="win-popup" id="winPopup">BIG WIN!<br><span id="winAmount">0</span> USDT</div>
  </div>

<script>
// Phaser Game Config
const config = {
  type: Phaser.AUTO,
  width: 480,
  height: 720,
  parent: 'game-container',
  backgroundColor: '#0a001f',
  scene: { preload, create, update }
};

const game = new Phaser.Game(config);
let reels, symbols = [], isSpinning = false;
let balance = 1000.00, bet = 1.00, totalWin = 0;

const symbolTypes = ['‚ô¶Ô∏è','‚ù§Ô∏è','‚≠ê','‚ö°','üíé','üåü','üçÄ','ü™ô','üí∞','7Ô∏è‚É£']; // 10 sembol

function preload() {
  this.load.audio('spin', 'https://assets.mixkit.co/sfx/preview/mixkit-slot-machine-win-1933.mp3');
  this.load.audio('win', 'https://assets.mixkit.co/sfx/preview/mixkit-winning-chimes-2015.mp3');
}

function create() {
  // Arka plan
  this.add.rectangle(240, 360, 480, 720, 0x0a001f);
  this.add.rectangle(240, 260, 420, 420, 0x1a0033, 0.8).setStrokeStyle(6, 0xffd700);

  // 6x5 Grid olu≈ütur
  reels = this.add.group();
  for(let col=0; col<6; col++){
    forAIT(let row=0; row<5; row++){
      let sym = this.add.text(70 + col*68, 120 + row*68, '?', {fontSize:'50px'}).setOrigin(0.5);
      symbols.push(sym);
      reels.add(sym);
    }
  }
}

function update() {}

function spin() {
  if(isSpinning || balance < bet) return;
  isSpinning = true;
  balance -= bet;
  updateBalance();
  document.getElementById('spinBtn').innerText = 'SPINNING...';

  // Ses
  if(game.sound.get('spin')) game.sound.play('spin');

  // Tumble efekti sim√ºlasyonu
  let spins = 0;
  const interval = setInterval(() => {
    symbols.forEach(s => s.setText(symbolTypes[Math.floor(Math.random()*10)]));
    spins++;
    if(spins > 15){
      clearInterval(interval);
      setTimeout(() => {
        finishSpin();
      }, 500);
    }
  }, 80);
}

function finishSpin() {
  // Rastgele kazan√ß (demo olduƒüu i√ßin %40 ihtimalle kazanƒ±r)
  const winMultiplier = Math.random() < 0.4 ? Phaser.Math.Between(1, 150) : 0;
  const win = (bet * winMultiplier).toFixed(2);
  if(win > 0){
    balance += parseFloat(win);
    totalWin += parseFloat(win);
    document.getElementById('winAmount').innerText = win + ' USDT';
    document.getElementById('winPopup').style.transform = 'translate(-50%,-50%) scale(1)';
    if(game.sound.get('win')) game.sound.play('win');
    setTimeout(() => {
      document.getElementById('winPopup').style.transform = 'translate(-50%,-50%) scale(0)';
    }, 2500);
  }
  updateBalance();
  document.getElementById('spinBtn').innerText = 'SPIN';
  isSpinning = false;
}

function changeBet(amount) {
  bet = Math.max(0.20, Math.min(1000, (bet + amount).toFixed(2)));
  document.getElementById('betAmount').innerText = bet.toFixed(2);
}

function updateBalance() {
  document.getElementById('balance').innerText = `Bakiye: ${balance.toFixed(2)} USDT (Demo)`;
}

// TON Wallet Baƒülantƒ± (ger√ßek √ßalƒ±≈üƒ±r)
const tonConnectUI = new TON_CONNECT_UI.TonConnectUI({
  manifestUrl: 'https://raw.githubusercontent.com/ton-community/tutorials/main/03-client/test/public/tonconnect-manifest.json'
});

async function connectWallet() {
  try {
    await tonConnectUI.openModal();
    alert("C√ºzdan baƒülandƒ±! Ger√ßek USDT modu aktif olur.");
  } catch(e) {
    alert("Baƒülantƒ± iptal edildi");
  }
}
</script>

<div style="position:absolute;bottom:10px;right:10px;color:#555;font-size:12px;">
  SpinDEX Demo v1.0 ‚Äì Ger√ßek versiyon √ßok yakƒ±nda! 
</div>
</body>
</html>