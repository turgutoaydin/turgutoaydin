<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
  <title>Köy Merkezi - 3D Demo (Düzeltilmiş)</title>
  <style>
    body { margin:0; overflow:hidden; background:#000; font-family:Arial, sans-serif; }
    #ui {
      position: absolute;
      top: 16px; left: 16px; color: white;
      background: rgba(0,0,0,0.5);
      padding: 12px 16px;
      border-radius: 10px;
      pointer-events: none;
      font-size: 15px;
      z-index: 10;
    }
    #info {
      position: absolute;
      bottom: 20px; left: 50%;
      transform: translateX(-50%);
      color: #fff;
      font-size: 15px;
      text-shadow: 0 1px 4px #000;
      pointer-events: none;
      z-index: 10;
    }
  </style>
</head>
<body>

<div id="ui">Köy Merkezi 3D Demo<br>Parmakla sürükle • Çift parmakla yakınlaştır</div>
<div id="info">My Village – Köyüm büyüyor...</div>

<script src="https://cdn.jsdelivr.net/npm/three@0.168.0/build/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.168.0/examples/js/controls/OrbitControls.min.js"></script>

<script>
// ======================== SAHNE ========================
const scene = new THREE.Scene();
scene.background = new THREE.Color(0x88ccff);
scene.fog = new THREE.FogExp2(0x88ccff, 0.0006);

const camera = new THREE.PerspectiveCamera(65, window.innerWidth / window.innerHeight, 0.1, 2000);
camera.position.set(20, 16, 28);
camera.lookAt(0, 1, 0);

const renderer = new THREE.WebGLRenderer({ 
  antialias: true,
  powerPreference: "high-performance"   // mobil için faydalı olabilir
});
renderer.setSize(window.innerWidth, window.innerHeight);
renderer.setPixelRatio(Math.min(window.devicePixelRatio, 1.5));  // ← en önemli düzeltme burası
renderer.shadowMap.enabled = true;
renderer.shadowMap.type = THREE.PCFSoftShadowMap;
document.body.appendChild(renderer.domElement);

// Kontroller
const controls = new THREE.OrbitControls(camera, renderer.domElement);
controls.enableDamping = true;
controls.dampingFactor = 0.08;
controls.rotateSpeed = 0.6;
controls.zoomSpeed = 1.0;
controls.minDistance = 6;
controls.maxDistance = 70;
controls.maxPolarAngle = Math.PI * 0.49;
controls.enablePan = false;           // mobil pan sorununu azaltır
controls.target.set(0, 1.5, 0);

// Işıklar
scene.add(new THREE.AmbientLight(0xffffff, 0.65));

const sun = new THREE.DirectionalLight(0xfff5e0, 1.3);
sun.position.set(35, 70, 45);
sun.castShadow = true;
sun.shadow.mapSize.width = 2048;
sun.shadow.mapSize.height = 2048;
sun.shadow.camera.near = 0.5;
sun.shadow.camera.far = 200;
sun.shadow.camera.left = -50;
sun.shadow.camera.right = 50;
sun.shadow.camera.top = 50;
sun.shadow.camera.bottom = -50;
scene.add(sun);

// ======================== ARAZİ ========================
const terrainSize = 90;
const segments = 90;
const geometry = new THREE.PlaneGeometry(terrainSize, terrainSize, segments, segments);
geometry.rotateX(-Math.PI / 2);

const vertices = geometry.attributes.position.array;
for (let i = 2; i < vertices.length; i += 3) {
  const x = vertices[i-2];
  const z = vertices[i];
  vertices[i] = Math.sin(x * 0.12) * 2.2 + Math.cos(z * 0.18) * 1.6 + Math.sin(x * 0.35 + z * 0.28) * 1.1;
}
geometry.computeVertexNormals();

const terrainMat = new THREE.MeshStandardMaterial({
  color: 0x6b9e3f,
  roughness: 0.95,
  metalness: 0.02
});
const terrain = new THREE.Mesh(geometry, terrainMat);
terrain.receiveShadow = true;
scene.add(terrain);

// ======================== EV & AĞAÇ FONKSİYONLARI ========================
function createHouse(x, z, scale = 1, wallColor = 0xe06666) {
  const group = new THREE.Group();

  const base = new THREE.Mesh(
    new THREE.BoxGeometry(5.2*scale, 0.5*scale, 6.2*scale),
    new THREE.MeshStandardMaterial({color: 0xcccccc})
  );
  base.position.y = 0.25*scale;
  base.castShadow = true;
  group.add(base);

  const walls = new THREE.Mesh(
    new THREE.BoxGeometry(4.8*scale, 3.4*scale, 5.8*scale),
    new THREE.MeshStandardMaterial({color: wallColor})
  );
  walls.position.y = 2*scale;
  walls.castShadow = true;
  group.add(walls);

  const roofGeo = new THREE.ConeGeometry(4.4*scale, 3.2*scale, 4);
  roofGeo.rotateY(Math.PI/4);
  const roof = new THREE.Mesh(roofGeo, new THREE.MeshStandardMaterial({color: 0x8b0000}));
  roof.position.y = 4*scale;
  roof.castShadow = true;
  group.add(roof);

  group.position.set(x, 0, z);
  return group;
}

function createTree(x, z) {
  const group = new THREE.Group();
  const trunk = new THREE.Mesh(
    new THREE.CylinderGeometry(0.7, 1, 4.5, 7),
    new THREE.MeshStandardMaterial({color: 0x8B4513})
  );
  trunk.position.y = 2.25;
  trunk.castShadow = true;
  group.add(trunk);

  const leaves = new THREE.Mesh(
    new THREE.ConeGeometry(3.5, 6, 7),
    new THREE.MeshStandardMaterial({color: 0x2e7d32})
  );
  leaves.position.y = 5.5;
  leaves.castShadow = true;
  group.add(leaves);

  const leaves2 = leaves.clone();
  leaves2.scale.set(0.75, 0.85, 0.75);
  leaves2.position.y = 7.2;
  group.add(leaves2);

  group.position.set(x, 0, z);
  return group;
}

// Nesneleri ekle
scene.add(createHouse(-10, -8, 1.15, 0xe57373));
scene.add(createHouse(8, -10, 1.0, 0x64b5f6));
scene.add(createHouse(14, 6, 1.25, 0xffb74d));

scene.add(createTree(-16, 10));
scene.add(createTree(18, -14));
scene.add(createTree(-4, 16));
scene.add(createTree(11, 13));

// Gölet
const water = new THREE.Mesh(
  new THREE.CircleGeometry(7, 32),
  new THREE.MeshStandardMaterial({
    color: 0x4488ff,
    roughness: 0.1,
    metalness: 0.4,
    transparent: true,
    opacity: 0.8
  })
);
water.rotation.x = -Math.PI/2;
water.position.set(-3, 0.12, 12);
scene.add(water);

// ======================== ANİMASYON ========================
function animate() {
  requestAnimationFrame(animate);
  controls.update();
  renderer.render(scene, camera);
}
animate();

// Resize
window.addEventListener('resize', () => {
  camera.aspect = window.innerWidth / window.innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(window.innerWidth, window.innerHeight);
});

// Opsiyonel: Konsola bilgi
console.log("Three.js demo yüklendi. Eğer hâlâ siyah ekran varsa → tarayıcı konsolunu (F12) kontrol et.");
</script>
</body>
</html>